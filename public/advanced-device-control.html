<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JASON Advanced Universal Device Control</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        color: white;
      }

      .header h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .control-panel {
        background: rgba(255, 255, 255, 0.95);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .control-panel h3 {
        margin-bottom: 20px;
        color: #333;
        font-size: 1.3rem;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        margin: 5px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }

      .btn-success {
        background: linear-gradient(135deg, #00d2d3 0%, #54a0ff 100%);
      }

      .devices-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .device-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: transform 0.3s ease;
      }

      .device-card:hover {
        transform: translateY(-5px);
      }

      .device-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .device-name {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
      }

      .device-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
        text-transform: uppercase;
      }

      .status-online {
        background: #d4edda;
        color: #155724;
      }

      .status-offline {
        background: #f8d7da;
        color: #721c24;
      }

      .device-info {
        margin-bottom: 15px;
        font-size: 0.9rem;
        color: #666;
      }

      .device-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .device-controls .btn {
        font-size: 0.8rem;
        padding: 8px 16px;
      }

      .log-container {
        background: rgba(0, 0, 0, 0.8);
        color: #00ff00;
        padding: 20px;
        border-radius: 15px;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        max-height: 400px;
        overflow-y: auto;
        margin-top: 20px;
      }

      .log-entry {
        margin-bottom: 5px;
        padding: 2px 0;
      }

      .log-timestamp {
        color: #888;
        margin-right: 10px;
      }

      .input-group {
        margin-bottom: 15px;
      }

      .input-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
      }

      .input-group input,
      .input-group select,
      .input-group textarea {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .input-group input:focus,
      .input-group select:focus,
      .input-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .category-filter {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        justify-content: center;
      }

      .filter-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .filter-btn.active {
        background: rgba(255, 255, 255, 0.9);
        color: #333;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover {
        color: #000;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ü§ñ JASON Advanced Universal Device Control</h1>
        <p>Real-time device discovery and control system</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalDevices">0</div>
          <div class="stat-label">Total Devices</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="onlineDevices">0</div>
          <div class="stat-label">Online Devices</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="mobileDevices">0</div>
          <div class="stat-label">Mobile Devices</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="smartHomeDevices">0</div>
          <div class="stat-label">Smart Home</div>
        </div>
      </div>

      <div class="controls">
        <div class="control-panel">
          <h3>üîç Discovery Controls</h3>
          <button class="btn" onclick="startDiscovery()">
            <span id="discoveryBtn">Start Full Discovery</span>
          </button>
          <button class="btn btn-success" onclick="refreshDevices()">
            Refresh Devices
          </button>
          <button class="btn btn-danger" onclick="clearDevices()">
            Clear All
          </button>
        </div>

        <div class="control-panel">
          <h3>üì± Mobile Device Controls</h3>
          <button class="btn" onclick="discoverMobileDevices()">
            Discover Mobile
          </button>
          <button class="btn" onclick="connectADB()">Connect ADB</button>
          <button class="btn" onclick="connectiOS()">Connect iOS</button>
        </div>

        <div class="control-panel">
          <h3>üè† Smart Home Controls</h3>
          <button class="btn" onclick="discoverSmartHome()">
            Discover Smart Home
          </button>
          <button class="btn" onclick="discoverHue()">Find Hue Bridges</button>
          <button class="btn" onclick="discoverTVs()">Find Smart TVs</button>
        </div>

        <div class="control-panel">
          <h3>üåê Network Controls</h3>
          <button class="btn" onclick="scanNetwork()">Network Scan</button>
          <button class="btn" onclick="discoverUPnP()">UPnP Discovery</button>
          <button class="btn" onclick="discoverBluetooth()">
            Bluetooth Scan
          </button>
        </div>
      </div>

      <div class="category-filter">
        <button class="filter-btn active" onclick="filterDevices('all')">
          All Devices
        </button>
        <button class="filter-btn" onclick="filterDevices('mobile')">
          üì± Mobile
        </button>
        <button class="filter-btn" onclick="filterDevices('smart_home')">
          üè† Smart Home
        </button>
        <button class="filter-btn" onclick="filterDevices('entertainment')">
          üì∫ Entertainment
        </button>
        <button class="filter-btn" onclick="filterDevices('computer')">
          üíª Computer
        </button>
        <button class="filter-btn" onclick="filterDevices('network')">
          üåê Network
        </button>
      </div>

      <div class="devices-grid" id="devicesGrid">
        <!-- Devices will be populated here -->
      </div>

      <div class="log-container" id="logContainer">
        <div class="log-entry">
          <span class="log-timestamp">[SYSTEM]</span>
          <span
            >JASON Advanced Universal Device Control System Initialized</span
          >
        </div>
      </div>
    </div>

    <!-- Device Control Modal -->
    <div id="deviceModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">Device Control</h2>
        <div id="modalContent">
          <!-- Dynamic content will be loaded here -->
        </div>
      </div>
    </div>

    <script>
      let devices = [];
      let currentFilter = "all";
      let ws = null;

      // Initialize WebSocket connection
      function initWebSocket() {
        ws = new WebSocket(`ws://${window.location.host}`);

        ws.onopen = function () {
          addLog("WebSocket connected");
        };

        ws.onmessage = function (event) {
          const data = JSON.parse(event.data);
          if (
            data.event === "device_discovered" ||
            data.event === "device_updated"
          ) {
            updateDevice(data.device);
            addLog(`Device ${data.event}: ${data.device.name}`);
          }
        };

        ws.onclose = function () {
          addLog("WebSocket disconnected. Attempting to reconnect...");
          setTimeout(initWebSocket, 3000);
        };
      }

      // Initialize the application
      async function init() {
        initWebSocket();
        await refreshDevices();
        setInterval(refreshDevices, 30000); // Refresh every 30 seconds
      }

      // Add log entry
      function addLog(message) {
        const logContainer = document.getElementById("logContainer");
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement("div");
        logEntry.className = "log-entry";
        logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span><span>${message}</span>`;
        logContainer.appendChild(logEntry);
        logContainer.scrollTop = logContainer.scrollHeight;
      }

      // API call helper
      async function apiCall(endpoint, method = "GET", data = null) {
        try {
          const options = {
            method,
            headers: {
              "Content-Type": "application/json",
            },
          };

          if (data) {
            options.body = JSON.stringify(data);
          }

          const response = await fetch(endpoint, options);
          return await response.json();
        } catch (error) {
          addLog(`API Error: ${error.message}`);
          return { success: false, error: error.message };
        }
      }

      // Discovery functions
      async function startDiscovery() {
        const btn = document.getElementById("discoveryBtn");
        btn.innerHTML = '<span class="loading"></span> Discovering...';

        addLog("Starting comprehensive device discovery...");
        const result = await apiCall("/api/universal-devices/discover", "POST");

        if (result.success) {
          addLog("Discovery completed successfully");
          await refreshDevices();
        } else {
          addLog(`Discovery failed: ${result.error}`);
        }

        btn.innerHTML = "Start Full Discovery";
      }

      async function discoverMobileDevices() {
        addLog("Discovering mobile devices...");
        const result = await apiCall(
          "/api/universal-devices/discover/mobile",
          "POST",
        );
        if (result.success) {
          addLog("Mobile device discovery completed");
          await refreshDevices();
        }
      }

      async function discoverSmartHome() {
        addLog("Discovering smart home devices...");
        const result = await apiCall(
          "/api/universal-devices/discover/smart-home",
          "POST",
        );
        if (result.success) {
          addLog("Smart home discovery completed");
          await refreshDevices();
        }
      }

      async function discoverHue() {
        addLog("Discovering Philips Hue bridges...");
        const result = await apiCall(
          "/api/universal-devices/discover/hue",
          "POST",
        );
        if (result.success) {
          addLog("Hue discovery completed");
          await refreshDevices();
        }
      }

      async function discoverTVs() {
        addLog("Discovering Smart TVs...");
        const result = await apiCall(
          "/api/universal-devices/discover/tv",
          "POST",
        );
        if (result.success) {
          addLog("TV discovery completed");
          await refreshDevices();
        }
      }

      async function scanNetwork() {
        addLog("Scanning network for devices...");
        const result = await apiCall(
          "/api/universal-devices/discover/network",
          "POST",
        );
        if (result.success) {
          addLog("Network scan completed");
          await refreshDevices();
        }
      }

      async function discoverUPnP() {
        addLog("Discovering UPnP devices...");
        const result = await apiCall(
          "/api/universal-devices/discover/upnp",
          "POST",
        );
        if (result.success) {
          addLog("UPnP discovery completed");
          await refreshDevices();
        }
      }

      async function discoverBluetooth() {
        addLog("Scanning for Bluetooth devices...");
        const result = await apiCall(
          "/api/universal-devices/discover/bluetooth",
          "POST",
        );
        if (result.success) {
          addLog("Bluetooth scan completed");
          await refreshDevices();
        }
      }

      async function connectADB() {
        addLog("Attempting to connect ADB devices...");
        // This would trigger ADB device discovery
        await discoverMobileDevices();
      }

      async function connectiOS() {
        addLog("Attempting to connect iOS devices...");
        // This would trigger iOS device discovery
        await discoverMobileDevices();
      }

      // Device management
      async function refreshDevices() {
        const result = await apiCall("/api/universal-devices");
        if (result.success) {
          devices = result.devices;
          updateStats();
          renderDevices();
        }
      }

      async function clearDevices() {
        if (confirm("Are you sure you want to clear all devices?")) {
          const result = await apiCall("/api/universal-devices/clear", "POST");
          if (result.success) {
            devices = [];
            updateStats();
            renderDevices();
            addLog("All devices cleared");
          }
        }
      }

      function updateDevice(device) {
        const index = devices.findIndex((d) => d.id === device.id);
        if (index >= 0) {
          devices[index] = device;
        } else {
          devices.push(device);
        }
        updateStats();
        renderDevices();
      }

      function updateStats() {
        document.getElementById("totalDevices").textContent = devices.length;
        document.getElementById("onlineDevices").textContent = devices.filter(
          (d) => d.status === "online",
        ).length;
        document.getElementById("mobileDevices").textContent = devices.filter(
          (d) => d.category === "mobile",
        ).length;
        document.getElementById("smartHomeDevices").textContent =
          devices.filter((d) => d.category === "smart_home").length;
      }

      function filterDevices(category) {
        currentFilter = category;

        // Update filter buttons
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        renderDevices();
      }

      function renderDevices() {
        const grid = document.getElementById("devicesGrid");
        const filteredDevices =
          currentFilter === "all"
            ? devices
            : devices.filter((d) => d.category === currentFilter);

        if (filteredDevices.length === 0) {
          grid.innerHTML =
            '<div style="grid-column: 1/-1; text-align: center; color: white; font-size: 1.2rem; padding: 40px;">No devices found. Try running discovery.</div>';
          return;
        }

        grid.innerHTML = filteredDevices
          .map(
            (device) => `
                <div class="device-card">
                    <div class="device-header">
                        <div class="device-name">${getDeviceIcon(device.type)} ${device.name}</div>
                        <div class="device-status ${device.status === "online" ? "status-online" : "status-offline"}">
                            ${device.status}
                        </div>
                    </div>
                    <div class="device-info">
                        <div><strong>Type:</strong> ${device.type}</div>
                        <div><strong>Manufacturer:</strong> ${device.manufacturer}</div>
                        <div><strong>IP:</strong> ${device.ip || "N/A"}</div>
                        <div><strong>Protocols:</strong> ${device.protocols.join(", ")}</div>
                        <div><strong>Last Seen:</strong> ${new Date(device.lastSeen).toLocaleString()}</div>
                    </div>
                    <div class="device-controls">
                        <button class="btn" onclick="openDeviceControl('${device.id}')">Control</button>
                        <button class="btn btn-success" onclick="testDevice('${device.id}')">Test</button>
                        <button class="btn btn-danger" onclick="removeDevice('${device.id}')">Remove</button>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      function getDeviceIcon(type) {
        const icons = {
          smartphone: "üì±",
          smart_tv: "üì∫",
          smart_plug: "üîå",
          smart_hub: "üè†",
          security_camera: "üìπ",
          router: "üåê",
          computer: "üíª",
          printer: "üñ®Ô∏è",
          bluetooth_headphones: "üéß",
          bluetooth_speaker: "üîä",
          iot_sensor: "üìä",
        };
        return icons[type] || "üìü";
      }

      // Device control
      async function openDeviceControl(deviceId) {
        const device = devices.find((d) => d.id === deviceId);
        if (!device) return;

        document.getElementById("modalTitle").textContent =
          `Control ${device.name}`;

        let controlsHTML = `
                <div class="input-group">
                    <label>Device Information</label>
                    <textarea readonly rows="4">${JSON.stringify(device, null, 2)}</textarea>
                </div>
                <div class="input-group">
                    <label>Available Capabilities</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            `;

        device.capabilities.forEach((cap) => {
          controlsHTML += `<button class="btn" onclick="executeCapability('${deviceId}', '${cap.name}')">${cap.name}</button>`;
        });

        controlsHTML += `
                    </div>
                </div>
                <div class="input-group">
                    <label>Custom Command</label>
                    <input type="text" id="customCommand" placeholder="Enter command">
                    <button class="btn" onclick="executeCustomCommand('${deviceId}')">Execute</button>
                </div>
            `;

        // Add device-specific controls
        if (device.type === "smartphone") {
          controlsHTML += `
                    <div class="input-group">
                        <label>Mobile Device Controls</label>
                        <button class="btn" onclick="takeScreenshot('${deviceId}')">Take Screenshot</button>
                        <button class="btn" onclick="getDeviceInfo('${deviceId}')">Get Device Info</button>
                        <button class="btn" onclick="listApps('${deviceId}')">List Apps</button>
                    </div>
                `;
        }

        if (device.type === "smart_tv") {
          controlsHTML += `
                    <div class="input-group">
                        <label>TV Controls</label>
                        <button class="btn" onclick="controlTV('${deviceId}', 'power_on')">Power On</button>
                        <button class="btn" onclick="controlTV('${deviceId}', 'power_off')">Power Off</button>
                        <input type="number" id="tvChannel" placeholder="Channel" style="width: 100px;">
                        <button class="btn" onclick="changeChannel('${deviceId}')">Change Channel</button>
                    </div>
                `;
        }

        if (device.type === "smart_plug") {
          controlsHTML += `
                    <div class="input-group">
                        <label>Smart Plug Controls</label>
                        <button class="btn btn-success" onclick="controlPlug('${deviceId}', 'power_on')">Turn On</button>
                        <button class="btn btn-danger" onclick="controlPlug('${deviceId}', 'power_off')">Turn Off</button>
                        <button class="btn" onclick="controlPlug('${deviceId}', 'get_status')">Get Status</button>
                    </div>
                `;
        }

        document.getElementById("modalContent").innerHTML = controlsHTML;
        document.getElementById("deviceModal").style.display = "block";
      }

      async function executeCapability(deviceId, capability) {
        addLog(`Executing ${capability} on device ${deviceId}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/control`,
          "POST",
          {
            command: capability,
            parameters: {},
          },
        );

        if (result.success) {
          addLog(
            `Command executed successfully: ${JSON.stringify(result.data)}`,
          );
        } else {
          addLog(`Command failed: ${result.error}`);
        }
      }

      async function executeCustomCommand(deviceId) {
        const command = document.getElementById("customCommand").value;
        if (!command) return;

        addLog(`Executing custom command "${command}" on device ${deviceId}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/control`,
          "POST",
          {
            command: command,
            parameters: {},
          },
        );

        if (result.success) {
          addLog(
            `Command executed successfully: ${JSON.stringify(result.data)}`,
          );
        } else {
          addLog(`Command failed: ${result.error}`);
        }
      }

      async function takeScreenshot(deviceId) {
        addLog(`Taking screenshot of device ${deviceId}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/control`,
          "POST",
          {
            command: "take_screenshot",
            parameters: {},
          },
        );

        if (result.success) {
          addLog(`Screenshot taken: ${result.data.screenshotPath}`);
        } else {
          addLog(`Screenshot failed: ${result.error}`);
        }
      }

      async function getDeviceInfo(deviceId) {
        addLog(`Getting device info for ${deviceId}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/control`,
          "POST",
          {
            command: "get_device_info",
            parameters: {},
          },
        );

        if (result.success) {
          addLog(
            `Device info retrieved: ${JSON.stringify(result.data, null, 2)}`,
          );
        } else {
          addLog(`Failed to get device info: ${result.error}`);
        }
      }

      async function listApps(deviceId) {
        addLog(`Listing apps on device ${deviceId}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/control`,
          "POST",
          {
            command: "list_apps",
            parameters: {},
          },
        );

        if (result.success) {
          addLog(`Apps found: ${result.data.length} apps`);
          console.log("Apps:", result.data);
        } else {
          addLog(`Failed to list apps: ${result.error}`);
        }
      }

      async function controlTV(deviceId, command) {
        addLog(`Sending ${command} to TV ${deviceId}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/control`,
          "POST",
          {
            command: command,
            parameters: {},
          },
        );

        if (result.success) {
          addLog(`TV command executed successfully`);
        } else {
          addLog(`TV command failed: ${result.error}`);
        }
      }

      async function changeChannel(deviceId) {
        const channel = document.getElementById("tvChannel").value;
        if (!channel) return;

        addLog(`Changing TV channel to ${channel}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/control`,
          "POST",
          {
            command: "change_channel",
            parameters: { channel: parseInt(channel) },
          },
        );

        if (result.success) {
          addLog(`Channel changed successfully`);
        } else {
          addLog(`Failed to change channel: ${result.error}`);
        }
      }

      async function controlPlug(deviceId, command) {
        addLog(`Sending ${command} to smart plug ${deviceId}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/control`,
          "POST",
          {
            command: command,
            parameters: {},
          },
        );

        if (result.success) {
          addLog(`Smart plug command executed: ${JSON.stringify(result.data)}`);
        } else {
          addLog(`Smart plug command failed: ${result.error}`);
        }
      }

      async function testDevice(deviceId) {
        addLog(`Testing device ${deviceId}`);
        const result = await apiCall(
          `/api/universal-devices/${deviceId}/test`,
          "POST",
        );

        if (result.success) {
          addLog(`Device test successful`);
        } else {
          addLog(`Device test failed: ${result.error}`);
        }
      }

      async function removeDevice(deviceId) {
        if (confirm("Are you sure you want to remove this device?")) {
          const result = await apiCall(
            `/api/universal-devices/${deviceId}`,
            "DELETE",
          );

          if (result.success) {
            devices = devices.filter((d) => d.id !== deviceId);
            updateStats();
            renderDevices();
            addLog(`Device ${deviceId} removed`);
          }
        }
      }

      function closeModal() {
        document.getElementById("deviceModal").style.display = "none";
      }

      // Initialize the application when the page loads
      window.addEventListener("load", init);
    </script>
  </body>
</html>

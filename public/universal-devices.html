<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JASON - Universal Device Control</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        color: white;
      }

      .header h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .controls {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .control-group {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .control-group label {
        color: white;
        font-weight: 600;
        margin-bottom: 5px;
        display: block;
      }

      select,
      input,
      button {
        padding: 10px 15px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        min-width: 150px;
      }

      button {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
      }

      .stat-card h3 {
        font-size: 2rem;
        margin-bottom: 5px;
        color: #4caf50;
      }

      .stat-card p {
        opacity: 0.9;
      }

      .devices-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
      }

      .device-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .device-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      }

      .device-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .device-name {
        font-size: 1.3rem;
        font-weight: 700;
        color: #333;
      }

      .device-status {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status-online {
        background: #4caf50;
        color: white;
      }

      .status-offline {
        background: #f44336;
        color: white;
      }

      .device-info {
        margin-bottom: 15px;
      }

      .device-info p {
        margin: 5px 0;
        color: #666;
      }

      .device-controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .device-controls button {
        flex: 1;
        min-width: 100px;
        padding: 8px 12px;
        font-size: 0.9rem;
      }

      .btn-primary {
        background: linear-gradient(45deg, #2196f3, #1976d2);
      }

      .btn-success {
        background: linear-gradient(45deg, #4caf50, #45a049);
      }

      .btn-warning {
        background: linear-gradient(45deg, #ff9800, #f57c00);
      }

      .btn-danger {
        background: linear-gradient(45deg, #f44336, #d32f2f);
      }

      .device-type-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-right: 15px;
      }

      .type-smartphone {
        background: linear-gradient(45deg, #4caf50, #45a049);
      }
      .type-desktop {
        background: linear-gradient(45deg, #2196f3, #1976d2);
      }
      .type-smart_light {
        background: linear-gradient(45deg, #ff9800, #f57c00);
      }
      .type-smart_tv {
        background: linear-gradient(45deg, #9c27b0, #7b1fa2);
      }
      .type-vehicle {
        background: linear-gradient(45deg, #f44336, #d32f2f);
      }
      .type-default {
        background: linear-gradient(45deg, #607d8b, #455a64);
      }

      .loading {
        text-align: center;
        color: white;
        font-size: 1.2rem;
        margin: 50px 0;
      }

      .error {
        background: rgba(244, 67, 54, 0.1);
        border: 1px solid rgba(244, 67, 54, 0.3);
        color: #f44336;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
      }

      .success {
        background: rgba(76, 175, 80, 0.1);
        border: 1px solid rgba(76, 175, 80, 0.3);
        color: #4caf50;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .close {
        font-size: 2rem;
        cursor: pointer;
        color: #999;
      }

      .close:hover {
        color: #333;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }

        .controls {
          flex-direction: column;
          align-items: center;
        }

        .devices-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ¤– JASON Universal Device Control</h1>
        <p>
          Control phones, computers, smart home, vehicles, and every connected
          device
        </p>
      </div>

      <div class="controls">
        <div class="control-group">
          <label for="categoryFilter">Filter by Category:</label>
          <select id="categoryFilter">
            <option value="">All Categories</option>
            <option value="mobile">ğŸ“± Mobile Devices</option>
            <option value="computer">ğŸ’» Computers</option>
            <option value="smart_home">ğŸ  Smart Home</option>
            <option value="entertainment">ğŸ® Entertainment</option>
            <option value="vehicle">ğŸš— Vehicles</option>
            <option value="appliance">ğŸ  Appliances</option>
            <option value="network">ğŸŒ Network</option>
            <option value="other">ğŸ”§ Other</option>
          </select>
        </div>

        <div class="control-group">
          <label for="statusFilter">Filter by Status:</label>
          <select id="statusFilter">
            <option value="">All Devices</option>
            <option value="true">Online Only</option>
            <option value="false">Offline Only</option>
          </select>
        </div>

        <div class="control-group">
          <button onclick="refreshDevices()">ğŸ”„ Refresh Devices</button>
        </div>

        <div class="control-group">
          <button onclick="startDiscovery()">ğŸ” Start Discovery</button>
        </div>

        <div class="control-group">
          <button onclick="showAddDeviceModal()">â• Add Device</button>
        </div>
      </div>

      <div class="stats" id="stats">
        <!-- Stats will be populated by JavaScript -->
      </div>

      <div id="loading" class="loading" style="display: none">
        Loading devices...
      </div>

      <div id="error" class="error" style="display: none"></div>
      <div id="success" class="success" style="display: none"></div>

      <div class="devices-grid" id="devicesGrid">
        <!-- Devices will be populated by JavaScript -->
      </div>
    </div>

    <!-- Add Device Modal -->
    <div id="addDeviceModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add New Device</h2>
          <span class="close" onclick="closeAddDeviceModal()">&times;</span>
        </div>
        <form id="addDeviceForm">
          <div style="margin-bottom: 15px">
            <label for="deviceName">Device Name:</label>
            <input
              type="text"
              id="deviceName"
              required
              style="width: 100%; margin-top: 5px"
            />
          </div>
          <div style="margin-bottom: 15px">
            <label for="deviceType">Device Type:</label>
            <select
              id="deviceType"
              required
              style="width: 100%; margin-top: 5px"
            >
              <option value="">Select Type</option>
              <option value="smartphone">ğŸ“± Smartphone</option>
              <option value="tablet">ğŸ“± Tablet</option>
              <option value="desktop">ğŸ’» Desktop Computer</option>
              <option value="laptop">ğŸ’» Laptop</option>
              <option value="smart_light">ğŸ’¡ Smart Light</option>
              <option value="smart_tv">ğŸ“º Smart TV</option>
              <option value="electric_vehicle">ğŸš— Electric Vehicle</option>
              <option value="smart_speaker">ğŸ”Š Smart Speaker</option>
            </select>
          </div>
          <div style="margin-bottom: 15px">
            <label for="deviceIP">IP Address (optional):</label>
            <input
              type="text"
              id="deviceIP"
              placeholder="192.168.1.100"
              style="width: 100%; margin-top: 5px"
            />
          </div>
          <div style="margin-bottom: 15px">
            <label for="deviceManufacturer">Manufacturer:</label>
            <input
              type="text"
              id="deviceManufacturer"
              placeholder="Apple, Samsung, Tesla, etc."
              style="width: 100%; margin-top: 5px"
            />
          </div>
          <div style="text-align: center">
            <button type="submit" style="margin-right: 10px">Add Device</button>
            <button type="button" onclick="closeAddDeviceModal()">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      let allDevices = [];
      let deviceStats = {};

      // Load devices on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadDevices();

        // Set up event listeners
        document
          .getElementById("categoryFilter")
          .addEventListener("change", filterDevices);
        document
          .getElementById("statusFilter")
          .addEventListener("change", filterDevices);
        document
          .getElementById("addDeviceForm")
          .addEventListener("submit", addDevice);
      });

      async function loadDevices() {
        showLoading(true);
        hideMessages();

        try {
          const response = await fetch("/api/universal-devices");
          const data = await response.json();

          if (data.success) {
            allDevices = data.devices;
            deviceStats = data.categories;
            updateStats(data);
            displayDevices(allDevices);
            showSuccess("Devices loaded successfully");
          } else {
            showError("Failed to load devices: " + data.error);
          }
        } catch (error) {
          showError("Error loading devices: " + error.message);
        } finally {
          showLoading(false);
        }
      }

      function updateStats(data) {
        const statsContainer = document.getElementById("stats");
        statsContainer.innerHTML = `
                <div class="stat-card">
                    <h3>${data.totalDevices}</h3>
                    <p>Total Devices</p>
                </div>
                <div class="stat-card">
                    <h3>${data.categories.mobile}</h3>
                    <p>ğŸ“± Mobile Devices</p>
                </div>
                <div class="stat-card">
                    <h3>${data.categories.computer}</h3>
                    <p>ğŸ’» Computers</p>
                </div>
                <div class="stat-card">
                    <h3>${data.categories.smart_home}</h3>
                    <p>ğŸ  Smart Home</p>
                </div>
                <div class="stat-card">
                    <h3>${data.categories.entertainment}</h3>
                    <p>ğŸ® Entertainment</p>
                </div>
                <div class="stat-card">
                    <h3>${data.categories.vehicle}</h3>
                    <p>ğŸš— Vehicles</p>
                </div>
            `;
      }

      function displayDevices(devices) {
        const grid = document.getElementById("devicesGrid");

        if (devices.length === 0) {
          grid.innerHTML =
            '<div style="text-align: center; color: white; font-size: 1.2rem; grid-column: 1 / -1;">No devices found. Try starting device discovery!</div>';
          return;
        }

        grid.innerHTML = devices
          .map((device) => createDeviceCard(device))
          .join("");
      }

      function createDeviceCard(device) {
        const typeIcon = getDeviceTypeIcon(device.type);
        const statusClass = device.online ? "status-online" : "status-offline";
        const statusText = device.online ? "Online" : "Offline";

        const controls = getDeviceControls(device);

        return `
                <div class="device-card">
                    <div class="device-header">
                        <div style="display: flex; align-items: center;">
                            <div class="device-type-icon type-${device.type.replace("_", "")}">
                                ${typeIcon}
                            </div>
                            <div class="device-name">${device.name}</div>
                        </div>
                        <div class="device-status ${statusClass}">${statusText}</div>
                    </div>
                    
                    <div class="device-info">
                        <p><strong>Type:</strong> ${device.type.replace("_", " ").toUpperCase()}</p>
                        <p><strong>Manufacturer:</strong> ${device.manufacturer || "Unknown"}</p>
                        <p><strong>Model:</strong> ${device.model || "Unknown"}</p>
                        ${device.ip ? `<p><strong>IP:</strong> ${device.ip}</p>` : ""}
                        <p><strong>Last Seen:</strong> ${new Date(device.lastSeen).toLocaleString()}</p>
                    </div>
                    
                    <div class="device-controls">
                        ${controls}
                    </div>
                </div>
            `;
      }

      function getDeviceTypeIcon(type) {
        const icons = {
          smartphone: "ğŸ“±",
          tablet: "ğŸ“±",
          desktop: "ğŸ’»",
          laptop: "ğŸ’»",
          server: "ğŸ–¥ï¸",
          smart_light: "ğŸ’¡",
          smart_tv: "ğŸ“º",
          smart_speaker: "ğŸ”Š",
          electric_vehicle: "ğŸš—",
          hybrid_vehicle: "ğŸš—",
          router: "ğŸŒ",
          camera: "ğŸ“·",
          thermostat: "ğŸŒ¡ï¸",
          door_lock: "ğŸ”’",
        };
        return icons[type] || "ğŸ”§";
      }

      function getDeviceControls(device) {
        const baseControls = `
                <button class="btn-primary" onclick="getDeviceStatus('${device.id}')">ğŸ“Š Status</button>
                <button class="btn-danger" onclick="removeDevice('${device.id}')">ğŸ—‘ï¸ Remove</button>
            `;

        if (device.type === "smartphone" || device.type === "tablet") {
          return `
                    ${baseControls}
                    <button class="btn-success" onclick="controlPhone('${device.id}', 'send_notification')">ğŸ“¢ Notify</button>
                    <button class="btn-warning" onclick="controlPhone('${device.id}', 'get_location')">ğŸ“ Location</button>
                `;
        } else if (
          device.type === "desktop" ||
          device.type === "laptop" ||
          device.type === "server"
        ) {
          return `
                    ${baseControls}
                    <button class="btn-warning" onclick="controlComputer('${device.id}', 'lock')">ğŸ”’ Lock</button>
                    <button class="btn-danger" onclick="controlComputer('${device.id}', 'shutdown')">âš¡ Shutdown</button>
                `;
        } else if (device.type.includes("vehicle")) {
          return `
                    ${baseControls}
                    <button class="btn-success" onclick="controlVehicle('${device.id}', 'lock_doors')">ğŸ”’ Lock</button>
                    <button class="btn-warning" onclick="controlVehicle('${device.id}', 'get_location')">ğŸ“ Location</button>
                `;
        } else if (device.type.includes("smart_")) {
          return `
                    ${baseControls}
                    <button class="btn-success" onclick="controlDevice('${device.id}', 'turn_on')">ğŸ”› Turn On</button>
                    <button class="btn-warning" onclick="controlDevice('${device.id}', 'turn_off')">â¹ï¸ Turn Off</button>
                `;
        }

        return baseControls;
      }

      async function controlDevice(deviceId, command, parameters = {}) {
        try {
          const response = await fetch(
            `/api/universal-devices/${deviceId}/control`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ command, parameters }),
            },
          );

          const data = await response.json();

          if (data.success) {
            showSuccess(`Command "${command}" executed successfully on device`);
            loadDevices(); // Refresh devices
          } else {
            showError(
              `Failed to execute command: ${data.response?.error || "Unknown error"}`,
            );
          }
        } catch (error) {
          showError(`Error controlling device: ${error.message}`);
        }
      }

      async function controlPhone(phoneId, action, parameters = {}) {
        try {
          const response = await fetch(
            `/api/universal-devices/phones/${phoneId}/${action}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(parameters),
            },
          );

          const data = await response.json();

          if (data.success) {
            showSuccess(`Phone action "${action}" executed successfully`);
          } else {
            showError(
              `Failed to execute phone action: ${data.response?.error || "Unknown error"}`,
            );
          }
        } catch (error) {
          showError(`Error controlling phone: ${error.message}`);
        }
      }

      async function controlComputer(computerId, action, parameters = {}) {
        try {
          const response = await fetch(
            `/api/universal-devices/computers/${computerId}/${action}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(parameters),
            },
          );

          const data = await response.json();

          if (data.success) {
            showSuccess(`Computer action "${action}" executed successfully`);
          } else {
            showError(
              `Failed to execute computer action: ${data.response?.error || "Unknown error"}`,
            );
          }
        } catch (error) {
          showError(`Error controlling computer: ${error.message}`);
        }
      }

      async function controlVehicle(vehicleId, action, parameters = {}) {
        try {
          const response = await fetch(
            `/api/universal-devices/vehicles/${vehicleId}/${action}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(parameters),
            },
          );

          const data = await response.json();

          if (data.success) {
            showSuccess(`Vehicle action "${action}" executed successfully`);
          } else {
            showError(
              `Failed to execute vehicle action: ${data.response?.error || "Unknown error"}`,
            );
          }
        } catch (error) {
          showError(`Error controlling vehicle: ${error.message}`);
        }
      }

      async function getDeviceStatus(deviceId) {
        try {
          const response = await fetch(
            `/api/universal-devices/${deviceId}/status`,
          );
          const data = await response.json();

          if (data.success) {
            alert(`Device Status:\n${JSON.stringify(data.status, null, 2)}`);
          } else {
            showError(`Failed to get device status: ${data.error}`);
          }
        } catch (error) {
          showError(`Error getting device status: ${error.message}`);
        }
      }

      async function removeDevice(deviceId) {
        if (!confirm("Are you sure you want to remove this device?")) {
          return;
        }

        try {
          const response = await fetch(`/api/universal-devices/${deviceId}`, {
            method: "DELETE",
          });

          const data = await response.json();

          if (data.success) {
            showSuccess("Device removed successfully");
            loadDevices();
          } else {
            showError(`Failed to remove device: ${data.error}`);
          }
        } catch (error) {
          showError(`Error removing device: ${error.message}`);
        }
      }

      async function startDiscovery() {
        showLoading(true);

        try {
          const response = await fetch(
            "/api/universal-devices/discovery/start",
            {
              method: "POST",
            },
          );

          const data = await response.json();

          if (data.success) {
            showSuccess(
              "Device discovery started. Devices will appear as they are found.",
            );
            // Refresh devices after a delay to show newly discovered devices
            setTimeout(loadDevices, 5000);
          } else {
            showError(`Failed to start discovery: ${data.error}`);
          }
        } catch (error) {
          showError(`Error starting discovery: ${error.message}`);
        } finally {
          showLoading(false);
        }
      }

      function filterDevices() {
        const categoryFilter = document.getElementById("categoryFilter").value;
        const statusFilter = document.getElementById("statusFilter").value;

        let filteredDevices = allDevices;

        if (categoryFilter) {
          filteredDevices = filteredDevices.filter((device) => {
            if (categoryFilter === "mobile") {
              return ["smartphone", "tablet"].includes(device.type);
            } else if (categoryFilter === "computer") {
              return ["desktop", "laptop", "server"].includes(device.type);
            } else if (categoryFilter === "smart_home") {
              return device.type.includes("smart_");
            } else if (categoryFilter === "entertainment") {
              return ["smart_tv", "speaker", "gaming_console"].includes(
                device.type,
              );
            } else if (categoryFilter === "vehicle") {
              return device.type.includes("vehicle");
            }
            return true;
          });
        }

        if (statusFilter) {
          const isOnline = statusFilter === "true";
          filteredDevices = filteredDevices.filter(
            (device) => device.online === isOnline,
          );
        }

        displayDevices(filteredDevices);
      }

      function refreshDevices() {
        loadDevices();
      }

      function showAddDeviceModal() {
        document.getElementById("addDeviceModal").style.display = "block";
      }

      function closeAddDeviceModal() {
        document.getElementById("addDeviceModal").style.display = "none";
        document.getElementById("addDeviceForm").reset();
      }

      async function addDevice(event) {
        event.preventDefault();

        const deviceData = {
          name: document.getElementById("deviceName").value,
          type: document.getElementById("deviceType").value,
          ip: document.getElementById("deviceIP").value || undefined,
          manufacturer:
            document.getElementById("deviceManufacturer").value || "Unknown",
        };

        try {
          const response = await fetch("/api/universal-devices/add", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(deviceData),
          });

          const data = await response.json();

          if (data.success) {
            showSuccess("Device added successfully");
            closeAddDeviceModal();
            loadDevices();
          } else {
            showError(`Failed to add device: ${data.error}`);
          }
        } catch (error) {
          showError(`Error adding device: ${error.message}`);
        }
      }

      function showLoading(show) {
        document.getElementById("loading").style.display = show
          ? "block"
          : "none";
      }

      function showError(message) {
        const errorDiv = document.getElementById("error");
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
        setTimeout(() => (errorDiv.style.display = "none"), 5000);
      }

      function showSuccess(message) {
        const successDiv = document.getElementById("success");
        successDiv.textContent = message;
        successDiv.style.display = "block";
        setTimeout(() => (successDiv.style.display = "none"), 3000);
      }

      function hideMessages() {
        document.getElementById("error").style.display = "none";
        document.getElementById("success").style.display = "none";
      }
    </script>
  </body>
</html>
